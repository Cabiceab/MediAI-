<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vyle - Comprehensive Medical AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <div class="container">
        <h1 class="text-center my-4">ü©∫ Vyle Medical AI System</h1>
        
        <div class="row">
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        Patient Assessment
                    </div>
                    <div class="card-body">
                        <div id="chatBox" class="chat-container"></div>
                        <div class="input-group mt-3">
                            <input type="text" id="symptomInput" class="form-control" 
                                   placeholder="Enter symptoms (comma separated)">
                            <button class="btn btn-success" onclick="analyzeSymptoms()">
                                Analyze
                            </button>
                        </div>
                        <div class="mt-3">
                            <input type="file" id="medicalImage" class="form-control" 
                                   accept="image/*" onchange="previewImage(event)">
                            <button class="btn btn-info mt-2" onclick="analyzeMedicalImage()">
                                Analyze Image
                            </button>
                        </div>
                        <div id="loading" class="mt-3 text-center" style="display: none;">
                            <div class="spinner-border text-primary" role="status"></div>
                            <p>Analyzing...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        Medical Database
                    </div>
                    <div class="card-body">
                        <div id="diseaseInfo"></div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-4 text-center text-muted small">
            ‚ö†Ô∏è This system provides preliminary information only. Always consult a healthcare professional.
        </footer>
    </div>

    <!-- Scripts -->
    <script src="scripts/medical-db.js"></script>
    <script src="scripts/symptom-map.js"></script>
    <script src="scripts/image-db.js"></script>
    <script src="scripts/icd11-service.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Main Application Logic
        async function analyzeSymptoms() {
            const symptoms = document.getElementById('symptomInput').value.split(',');
            showLoading(true);
            
            try {
                const results = await getDifferentialDiagnosis(symptoms);
                displayDiagnosis(results);
            } catch (error) {
                showError("Analysis failed: " + error.message);
            }
            
            showLoading(false);
        }

        async function analyzeMedicalImage() {
            const file = document.getElementById('medicalImage').files[0];
            if (!file) return;
            
            showLoading(true);
            
            try {
                const analysis = await analyzeImage(file);
                displayImageDiagnosis(analysis);
            } catch (error) {
                showError("Image analysis failed: " + error.message);
            }
            
            showLoading(false);
        }

        // Display Functions
        function displayDiagnosis(results) {
            const container = document.getElementById('diseaseInfo');
            container.innerHTML = results.map(result => `
                <div class="diagnosis-card">
                    <h5>${result.name}</h5>
                    <p><strong>ICD-11 Code:</strong> ${result.code}</p>
                    <p>${result.description}</p>
                    <div class="alert alert-warning">${result.recommendation}</div>
                </div>
            `).join('');
        }

        function displayImageDiagnosis(analysis) {
            const container = document.getElementById('diseaseInfo');
            container.innerHTML = `
                <div class="image-diagnosis">
                    <h5>${analysis.condition}</h5>
                    <p>Confidence: ${analysis.confidence}%</p>
                    <img src="${analysis.preview}" class="img-fluid">
                    <div class="mt-2">${analysis.description}</div>
                </div>
            `;
        }

        // Utility Functions
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showError(message) {
            const container = document.getElementById('diseaseInfo');
            container.innerHTML = `<div class="alert alert-danger">${message}</div>`;
        }
    </script>
</body>
</html>
